#jinja2: lstrip_blocks: True
# {{ ansible_managed }}
autodetection_retry: {{ openio_netdata_python_d_retry }}

# -------------------------------------------
# OpenIO SDS logs

{% if 'rawx' in inventory %}
    {% for instance in inventory.rawx %}
{{ instance.id }}:
    name: '.openio.{{ openio_netdata_namespace }}.rawx.rawx-{{ loop.index }}.log.access'
    path: '/var/log/oio/sds/{{ openio_netdata_namespace }}/rawx-{{ loop.index }}/rawx-{{ loop.index }}-httpd-access.log'
    custom_log_format:
        pattern: '\S+ \S+ \S+ \S+ \S+ \d+ \d+ \S+ \S+ (?P<address>\S+) \S+ (?P<method>\S+) (?P<code>\d+) (?P<resp_time>\d+) (?P<bytes_sent>\d+) \S+ \S+ (?P<url>.*)'
    {% endfor %}
{% endif %}

{% for service in ['meta0', 'meta1', 'meta2'] %}
    {% if service in inventory %}
        {% for instance in inventory[service] %}
{{ instance.id }}:
    name: '.openio.{{ openio_netdata_namespace }}.{{service}}.{{service}}-{{ loop.index }}.log.access'
    path: '/var/log/oio/sds/{{ openio_netdata_namespace }}/{{service}}-{{ loop.index }}/{{service}}-{{ loop.index }}.access'
    custom_log_format:
        pattern: '\S+ \S+ \S+ \S+  \S+ \S+ \S+ \S+ (?P<address>\S+) \S+ (?P<method>\S+) (?P<code>\d+) (?P<resp_time>\d+) (?P<bytes_sent>\d+) \S+ \S+ \S+ (?P<url>.*)'
        {% endfor %}
    {% endif %}
{% endfor %}

{% if 'oioswift' in inventory %}
    {% for instance in inventory.oioswift %}
{{ instance.id }}:
name: '.openio.{{ openio_netdata_namespace }}.oioswift.oioswift-{{ loop.index }}.log.access'
path: '/var/log/oio/sds/{{ openio_netdata_namespace }}/oioswift-{{ loop.index }}/oioswift-{{ loop.index }}.access'
custom_log_format:
    pattern: '\S+ \S+ \S+ \S+  \S+ \S+ \S+ \S+ (?P<address>\S+) \S+ (?P<method>\S+) (?P<code>\d+) (?P<resp_time>\d+) (?P<bytes_sent>\d+) \S+ \S+ \S+ (?P<url>.*)'
    {% endfor %}
{% endif %}
